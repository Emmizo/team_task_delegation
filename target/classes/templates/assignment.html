<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Assignment · Team Task Delegation</title>
    <link rel="stylesheet" th:href="@{/css/app.css}">
</head>
<body>
<div class="app">
    <nav class="nav">
        <a href="/assignment" class="active">Assignment</a>
        <a href="/members">Team Members</a>
    </nav>

    <div class="card">
        <h1>New project assignment</h1>
        <p>Each task is assigned to one member. Members may be on multiple projects, subject to workload cap.</p>
        <form th:action="@{/assignment}" th:object="${projectForm}" method="post">
            <div class="form-row">
                <label for="projectName">Project name</label>
                <input type="text" id="projectName" th:field="*{projectName}" placeholder="e.g. Data mesh platform"/>
                <div class="text-error" th:if="${#fields.hasErrors('projectName')}" th:errors="*{projectName}"></div>
            </div>

            <div class="form-row">
                <label for="durationWeeks">Duration (weeks)</label>
                <input type="number" id="durationWeeks" step="0.5" min="1" th:field="*{durationWeeks}" placeholder="4"/>
                <span class="field-hint">Estimated person-weeks to complete.</span>
                <div class="text-error" th:if="${#fields.hasErrors('durationWeeks')}" th:errors="*{durationWeeks}"></div>
            </div>

            <div class="form-row">
                <label for="requiredSkillsRaw">Required skills</label>
                <textarea id="requiredSkillsRaw" th:field="*{requiredSkillsRaw}" placeholder="laravel:0.7&#10;mysql:0.6&#10;react:0.5"></textarea>
                <span class="field-hint">One per line: <code>skill:intensity</code> (0–1).</span>
            </div>

            <div class="form-row">
                <label for="objectivesRaw">Objectives</label>
                <textarea id="objectivesRaw" th:field="*{objectivesRaw}" placeholder="Manage, control, monitor"></textarea>
                <span class="field-hint">Comma-separated. Success criteria or keywords.</span>
            </div>

            <div class="form-row">
                <label for="urgency">Urgency</label>
                <select id="urgency" th:field="*{urgency}">
                    <option th:each="u : ${T(com.teamdelegation.model.Urgency).values()}"
                            th:value="${u}" th:text="${u + ' (' + u.getWeight() + ')'}"></option>
                </select>
                <span class="field-hint">High-urgency tasks are staffed first when assigning multiple tasks.</span>
            </div>

            <div class="form-row">
                <label>
                    <input type="checkbox" th:field="*{learningOpportunity}"/>
                    Learning opportunity
                </label>
                <span class="field-hint">Suitable for upskilling. Allows assignment to members with lower expertise.</span>
            </div>

            <div class="text-error" th:if="${#fields.hasGlobalErrors()}" th:each="err : ${#fields.globalErrors()}" th:text="${err}"></div>

            <button type="submit" class="btn">Compute recommendation</button>
        </form>
    </div>

    <div class="card">
        <h2>Member pool</h2>
        <p class="text-muted" style="margin: 0 0 1rem 0;">Eligible for assignment. <a href="/members">Add members</a>.</p>
        <div class="table-wrap">
            <table>
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Performance</th>
                    <th>Growth</th>
                    <th>Load (wks)</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="member : ${members}">
                    <td th:text="${member.name}"></td>
                    <td th:text="${#numbers.formatDecimal(member.recentPerformance, 1, 2)}"></td>
                    <td th:text="${#numbers.formatDecimal(member.growthDesire, 1, 2)}"></td>
                    <td th:text="${#numbers.formatDecimal(member.totalRemainingWeeks, 1, 1)}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(members)}">
                    <td colspan="4" class="text-muted">No members. Add profiles first.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div class="card" th:if="${lastDecision != null}">
        <h2>Last recommendation</h2>
        <p style="margin: 0;"><span class="text-muted">Project</span> <strong th:text="${lastDecision.demand.projectName}"></strong>
            <span th:if="${lastDecision.assignee != null}" class="text-muted"> → </span>
            <span th:if="${lastDecision.assignee != null}" class="assignee-name" th:text="${lastDecision.assignee.name}"></span>
        </p>
    </div>
</div>
</body>
</html>
